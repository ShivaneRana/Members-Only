<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include("./partials/head",{title: "Home",style:['style','navbar']})%>
    </head>
    <body>
        <%- include("./partials/navbar")%>
        <main>

        <h1>Posts</h1>

        <% if(locals.currentUser){ %>
        <form class="post-header" method="post">
            <label for="post_text">Enter post: </label>
            <textarea name="post_text" placeholder="Enter posts"></textarea>
            <div class="button-container">
                <button type="reset">Clear</button>
                <button type="submit">Post</button>
            </div>
        </form>

        <% }else{ %>

        <div class="post-header">
            <h3>Log in to post!</h3>
            <a href="/log-in">Login</a>
        </div>

        <% } %>

        <% if(locals.posts.length !== 0){ %>
        <section class="global-posts">
            <% for(let i = 0 ; i < posts.length; i++){ %>
                <article class="posts">
                    <% if(locals.currentUser && locals.currentUser.is_admin){ %>
                        <a href="/posts/delete/<%= posts[i].tid %>" class="delete-post-button">Delete</a>
                    <% } %>

                    <!-- when you try to access currentUser but the user is not logged in so currentUser is not assinged -->
                    <% if(locals.currentUser){ %>
                        <% if(locals.currentUser.is_member){ %>
                            <p>Username: <%= posts[i].username%></p>
                        <% }else{ %>
                            <p>Username: *******</p>
                        <% } %>
                    <% }else{ %>
                            <p>Username: *******</p>
                    <% } %>


                    <% if(locals.currentUser){ %>
                        <% if(locals.currentUser.is_member){ %>
                            
                            <p>Created_at: <%= posts[i].created_at%></p>
                        <% }else{ %>
                            <p>Created_at: *******</p>
                        <% } %>
                    <% }else{ %>
                            <p>Created_at: *******</p>
                    <% } %>

                    <p>Message: <%= posts[i].message_text%></p>
                </article>

            <% } %>
        </section>
        <% } %>

        </main>
    </body>
</html>